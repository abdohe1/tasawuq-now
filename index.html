<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</title>

<style>
body {
  margin: 0;
  font-family: Tahoma, Arial;
  background: #f4f6f8;
}

header {
  background: linear-gradient(135deg,#0d6efd,#0a58ca);
  color: white;
  text-align: center;
  padding: 20px;
}

header h1 {
  margin: 0;
}

nav button {
  margin: 5px;
  padding: 10px 18px;
  border: none;
  border-radius: 12px;
  font-weight: bold;
  cursor: pointer;
}

.container {
  padding: 15px;
}

.search {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  margin-bottom: 15px;
}

.card {
  background: white;
  border-radius: 15px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,.08);
}

.card img {
  width: 100%;
  border-radius: 10px;
  margin-bottom: 10px;
}

.card h3 {
  margin: 5px 0;
}

.price {
  color: green;
  font-weight: bold;
}

.actions button {
  width: 48%;
  padding: 10px;
  border: none;
  border-radius: 10px;
  color: white;
}

.delete { background: #dc3545; }
.edit { background: #198754; }

#form, #admin { display: none; }

input, select {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<header>
  <h1>ğŸ›’ ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</h1>
  <nav>
    <button onclick="showHome()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button onclick="showForm()">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</button>
    <button onclick="showAdmin()">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
    <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
  </nav>
</header>

<div class="container" id="home">
  <input class="search" placeholder="Ø§Ø¨Ø­Ø«..." oninput="searchPosts(this.value)">
  <div id="posts"></div>
</div>

<div class="container" id="form">
  <h2 id="formTitle">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</h2>
  <input id="title" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
  <input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
  <input type="file" id="image">
  <button onclick="savePost()">Ø­ÙØ¸</button>
</div>

<div class="container" id="admin">
  <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
  <div id="adminPosts"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInAnonymously, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "PUT_API_KEY",
  authDomain: "PUT_AUTH_DOMAIN",
  projectId: "PUT_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let posts = [];
let editId = null;
let imageData = "";

const postsBox = document.getElementById("posts");
const adminBox = document.getElementById("adminPosts");

document.getElementById("image").addEventListener("change", e => {
  const reader = new FileReader();
  reader.onload = () => imageData = reader.result;
  reader.readAsDataURL(e.target.files[0]);
});

async function loadPosts() {
  postsBox.innerHTML = "ØªØ­Ù…ÙŠÙ„...";
  posts = [];
  const snap = await getDocs(collection(db,"posts"));
  snap.forEach(d => posts.push({id:d.id,...d.data()}));
  render(posts);
}

function render(list) {
  postsBox.innerHTML = "";
  list.forEach((p,i)=>{
    postsBox.innerHTML += `
      <div class="card">
        ${p.image ? `<img src="${p.image}">` : ""}
        <h3>${p.title}</h3>
        <div class="price">${p.price} ğŸ’°</div>
      </div>
    `;
  });
}

window.savePost = async () => {
  const title = title.value;
  const price = price.value;
  if(!title || !price) return alert("Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„");

  await addDoc(collection(db,"posts"),{title,price,image:imageData});
  showHome();
  loadPosts();
}

window.searchPosts = v => {
  render(posts.filter(p=>p.title.includes(v)));
}

window.showHome = () => {
  home.style.display="block";
  form.style.display="none";
  admin.style.display="none";
}

window.showForm = () => {
  form.style.display="block";
  home.style.display="none";
  admin.style.display="none";
}

window.showAdmin = async () => {
  admin.style.display="block";
  home.style.display="none";
  form.style.display="none";
  adminBox.innerHTML="";
  const snap = await getDocs(collection(db,"posts"));
  snap.forEach(d=>{
    adminBox.innerHTML+=`
      <div class="card">
        <h3>${d.data().title}</h3>
        <button onclick="deletePost('${d.id}')">Ø­Ø°Ù</button>
      </div>`;
  });
}

window.deletePost = async id => {
  if(confirm("Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ")){
    await deleteDoc(doc(db,"posts",id));
    showAdmin();
  }
}

window.login = () => signInAnonymously(auth);
window.logout = () => signOut(auth);

loadPosts();
</script>

</body>
</html>
