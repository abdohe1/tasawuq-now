<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ³ÙˆÙ‘Ù‚ Ø§Ù„Ø¢Ù†</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Tahoma;background:#f2f4f8}
header{background:#0d6efd;color:#fff;padding:15px;text-align:center}
nav button{margin:5px;padding:8px 14px;border:none;border-radius:8px;font-weight:bold}
.container{max-width:900px;margin:auto;padding:15px}
.card{background:#fff;border-radius:12px;padding:15px;margin-bottom:15px}
.hidden{display:none}
input,select{width:100%;padding:10px;margin:6px 0}
.actions button{margin:4px}
</style>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<header>
<h2>ğŸ›’ ØªØ³ÙˆÙ‘Ù‚ Ø§Ù„Ø¢Ù†</h2>
<nav>
<button onclick="show('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<button onclick="show('add')">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</button>
<button onclick="show('dashboard')">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
<button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
</nav>
</header>

<div class="container">

<!-- AUTH -->
<div id="auth" class="card">
<h3>ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„</h3>
<input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- SEARCH -->
<input id="search" placeholder="ğŸ” Ø¨Ø­Ø«" oninput="loadPosts()">

<!-- HOME -->
<div id="home"></div>

<!-- ADD -->
<div id="add" class="card hidden">
<h3>Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</h3>
<input id="title" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
<select id="category">
<option>Ø³ÙŠØ§Ø±Ø§Øª</option>
<option>Ø¯Ø±Ø§Ø¬Ø§Øª</option>
<option>Ø£Ù„Ø¹Ø§Ø¨</option>
</select>
<input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<button onclick="addPost()">Ø­ÙØ¸</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden"></div>

</div>

<script>
/* ğŸ”´ Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù‡Ù†Ø§ */
const firebaseConfig = {
  apiKey: "PUT_YOUR_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT",
};
/* ğŸ”´ Ø§Ù†ØªÙ‡Ù‰ */

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
    document.getElementById("auth").style.display="none";
    loadPosts();
    loadMyPosts();
  }else{
    document.getElementById("auth").style.display="block";
  }
});

function register(){
  auth.createUserWithEmailAndPassword(email.value,password.value);
}
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value);
}
function logout(){
  auth.signOut();
}

function show(id){
  document.querySelectorAll(".container > div").forEach(d=>d.classList.add("hidden"));
  document.getElementById(id)?.classList.remove("hidden");
}

function addPost(){
  db.collection("posts").add({
    title:title.value,
    category:category.value,
    price:price.value,
    uid:currentUser.uid
  });
}

function loadPosts(){
  home.innerHTML="";
  const q = search.value.toLowerCase();
  db.collection("posts").onSnapshot(s=>{
    s.forEach(d=>{
      const p=d.data();
      if(p.title.toLowerCase().includes(q)){
        home.innerHTML+=`
        <div class="card">
        <b>${p.title}</b><br>
        ${p.category} â€“ ğŸ’° ${p.price}
        </div>`;
      }
    });
  });
}

function loadMyPosts(){
  dashboard.innerHTML="<h3>Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</h3>";
  db.collection("posts").where("uid","==",currentUser.uid)
  .onSnapshot(s=>{
    s.forEach(d=>{
      const p=d.data();
      dashboard.innerHTML+=`
      <div class="card">
      ${p.title}
      <button onclick="db.collection('posts').doc('${d.id}').delete()">Ø­Ø°Ù</button>
      </div>`;
    });
  });
}
</script>

</body>
</html>
