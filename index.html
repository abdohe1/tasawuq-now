<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d6efd">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="icon.png">

<style>
body{margin:0;font-family:Tahoma,Arial;background:#f2f4f8}
header{
background:linear-gradient(135deg,#0d6efd,#0aa2c0);
color:white;padding:25px;text-align:center;
border-bottom-left-radius:25px;
border-bottom-right-radius:25px;
}
header button{
background:white;border:none;
padding:10px 15px;margin:5px;
border-radius:12px;font-weight:bold;cursor:pointer
}
.box{
background:white;margin:20px;
padding:20px;border-radius:16px;
box-shadow:0 3px 10px rgba(0,0,0,.08)
}
input,select{
width:100%;padding:12px;margin-bottom:10px;
border-radius:10px;border:1px solid #ccc;font-size:16px
}
button.main{
width:100%;padding:12px;border:none;
border-radius:12px;font-size:18px;
color:white;background:#0d6efd;cursor:pointer
}
.post{border-bottom:1px solid #eee;padding:10px 0}
.price{color:green;font-weight:bold}
.hidden{display:none}
.admin{color:red;font-weight:bold}
.catBtn{
padding:6px 10px;margin:3px;
border:none;border-radius:8px;
cursor:pointer;background:#eee
}
</style>
</head>

<body>

<header>
<h2>ğŸ›’ ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</h2>
<button onclick="showHome()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<button onclick="showForm()">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</button>
<button onclick="showMyPosts()">Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</button>
<button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
<span id="adminLabel" class="admin hidden">ADMIN</span>
</header>

<div class="box" id="authBox">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h3>
<input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="main" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<br><br>
<button class="main" style="background:#198754" onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
</div>

<div class="box hidden" id="home">
<h3>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>

<input id="searchInput" placeholder="Ø¨Ø­Ø«..." oninput="loadPosts()">

<div>
<button class="catBtn" onclick="filterCategory('Ø§Ù„ÙƒÙ„')">Ø§Ù„ÙƒÙ„</button>
<button class="catBtn" onclick="filterCategory('Ø³ÙŠØ§Ø±Ø§Øª')">Ø³ÙŠØ§Ø±Ø§Øª</button>
<button class="catBtn" onclick="filterCategory('Ø¯Ø±Ø§Ø¬Ø§Øª')">Ø¯Ø±Ø§Ø¬Ø§Øª</button>
<button class="catBtn" onclick="filterCategory('Ø§Ù„Ø¹Ø§Ø¨')">Ø§Ù„Ø¹Ø§Ø¨</button>
<button class="catBtn" onclick="filterCategory('Ø¹Ù‚Ø§Ø±Ø§Øª')">Ø¹Ù‚Ø§Ø±Ø§Øª</button>
<button class="catBtn" onclick="filterCategory('ÙˆØ¸Ø§Ø¦Ù')">ÙˆØ¸Ø§Ø¦Ù</button>
</div>

<div id="posts"></div>
</div>

<div class="box hidden" id="form">
<h3>Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</h3>
<input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
<input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<select id="category">
<option>Ø³ÙŠØ§Ø±Ø§Øª</option>
<option>Ø¯Ø±Ø§Ø¬Ø§Øª</option>
<option>Ø§Ù„Ø¹Ø§Ø¨</option>
<option>Ø¹Ù‚Ø§Ø±Ø§Øª</option>
<option>ÙˆØ¸Ø§Ø¦Ù</option>
</select>
<button class="main" onclick="savePost()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth,createUserWithEmailAndPassword,signInWithEmailAndPassword,onAuthStateChanged,signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore,collection,addDoc,onSnapshot,deleteDoc,doc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBuhnSrkn6jXcCxUnbL-o14gd5pS9wRmnY",
authDomain:"tasawuq-now-eb955.firebaseapp.com",
projectId:"tasawuq-now-eb955",
storageBucket:"tasawuq-now-eb955.firebasestorage.app",
messagingSenderId:"786110830242",
appId:"1:786110830242:web:15a4752cd9b5db3f0129fb"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth();
const db=getFirestore();

const ADMIN_EMAIL="abdoalk73@gmail.com";
let isAdmin=false;
let showOnlyMine=false;
let currentCategory="Ø§Ù„ÙƒÙ„";

const authBox=document.getElementById("authBox");
const home=document.getElementById("home");
const form=document.getElementById("form");
const postsBox=document.getElementById("posts");
const adminLabel=document.getElementById("adminLabel");

onAuthStateChanged(auth,user=>{
if(user){
isAdmin=user.email===ADMIN_EMAIL;
authBox.classList.add("hidden");
home.classList.remove("hidden");
adminLabel.classList.toggle("hidden",!isAdmin);
loadPosts();
}else{
authBox.classList.remove("hidden");
home.classList.add("hidden");
form.classList.add("hidden");
adminLabel.classList.add("hidden");
}
});

window.register=()=>createUserWithEmailAndPassword(auth,email.value,password.value).catch(e=>alert(e.message));
window.login=()=>signInWithEmailAndPassword(auth,email.value,password.value).catch(e=>alert(e.message));
window.logout=()=>signOut(auth);

window.showHome=()=>{showOnlyMine=false;home.classList.remove("hidden");form.classList.add("hidden");loadPosts();};
window.showForm=()=>{if(!auth.currentUser){alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ");return;}form.classList.remove("hidden");home.classList.add("hidden");};
window.showMyPosts=()=>{showOnlyMine=true;loadPosts();};
window.filterCategory=(cat)=>{currentCategory=cat;loadPosts();};

window.savePost=async()=>{
if(!auth.currentUser){alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ");return;}
await addDoc(collection(db,"posts"),{
title:title.value,
price:price.value,
category:category.value,
userId:auth.currentUser.uid,
userEmail:auth.currentUser.email,
createdAt:Date.now()
});
title.value="";price.value="";showHome();
};

function loadPosts(){
onSnapshot(collection(db,"posts"),snap=>{
postsBox.innerHTML="";
const searchText=document.getElementById("searchInput").value.toLowerCase();
snap.forEach(docSnap=>{
const p=docSnap.data();
const id=docSnap.id;
if(showOnlyMine && auth.currentUser?.uid!==p.userId) return;
if(currentCategory!=="Ø§Ù„ÙƒÙ„" && p.category!==currentCategory) return;
if(searchText && !p.title.toLowerCase().includes(searchText)) return;
let deleteBtn="";
if(isAdmin || auth.currentUser?.uid===p.userId){
deleteBtn=`<button onclick="deletePost('${id}')">Ø­Ø°Ù</button>`;
}
postsBox.innerHTML+=`
<div class="post">
<strong>${p.title}</strong><br>
<span>${p.category}</span><br>
<span class="price">${p.price} ğŸ’°</span><br>
${deleteBtn}
</div>`;
});
});
}

window.deletePost=async(id)=>await deleteDoc(doc(db,"posts",id));

if ('serviceWorker' in navigator) {
window.addEventListener('load', () => {
navigator.serviceWorker.register('sw.js');
});
}
</script>

</body>
</html>
