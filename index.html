<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:tahoma}
body{margin:0;background:#f2f4f8}
header{
background:linear-gradient(135deg,#0d6efd,#0aa2c0);
padding:20px;text-align:center;color:#fff;
border-radius:0 0 25px 25px
}
header button{
background:#fff;color:#0d6efd;
border:none;padding:10px 14px;
border-radius:12px;margin:5px;
font-weight:bold;cursor:pointer
}
#container{padding:15px}
.card{
background:#fff;padding:15px;
border-radius:16px;margin-bottom:15px;
box-shadow:0 3px 10px rgba(0,0,0,.08)
}
input,select{
width:100%;padding:12px;margin-bottom:10px;
border-radius:10px;border:1px solid #ccc
}
.green{background:#198754;color:#fff}
.red{background:#dc3545;color:#fff}
.hide{display:none}
.price{color:green;font-weight:bold}
</style>
</head>

<body>

<header>
<h2>ğŸ›’ ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</h2>
<button onclick="showHome()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
<button onclick="showForm()">Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</button>
<button onclick="showMy()">Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</button>
<button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
</header>

<div id="container">

<!-- ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ -->
<div id="authBox" class="card">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h3>
<input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="green" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
</div>

<!-- Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† -->
<div id="formBox" class="card hide">
<h3>Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù†</h3>
<input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†">
<input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<select id="category">
<option>Ø³ÙŠØ§Ø±Ø§Øª</option>
<option>Ø¯Ø±Ø§Ø¬Ø§Øª</option>
<option>Ø§Ù„Ø¹Ø§Ø¨</option>
<option>Ø¹Ù‚Ø§Ø±Ø§Øª</option>
<option>ÙˆØ¸Ø§Ø¦Ù</option>
</select>
<button class="green" onclick="savePost()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
</div>

<!-- Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª -->
<div id="posts"></div>

</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword,
onAuthStateChanged,
signOut
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

import {
getFirestore,
collection,
addDoc,
getDocs,
query,
where
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

/* Firebase Config */
const firebaseConfig = {
apiKey: "AIzaSyBuhnSrkn6jXcCxUnbL-o14gd5pS9wRmnY",
authDomain: "tasawuq-now-eb955.firebaseapp.com",
projectId: "tasawuq-now-eb955",
storageBucket: "tasawuq-now-eb955.firebasestorage.app",
messagingSenderId: "786110830242",
appId: "1:786110830242:web:15a4752cd9b5db3f0129fb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;

/* Auth State */
onAuthStateChanged(auth,(user)=>{
currentUser = user;
document.getElementById("authBox").style.display = user ? "none" : "block";
showHome();
});

/* Auth Functions */
window.login = () =>
signInWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>alert(e.message));

window.register = () =>
createUserWithEmailAndPassword(auth,email.value,password.value)
.catch(e=>alert(e.message));

window.logout = () => signOut(auth);

/* Navigation */
window.showHome = ()=>loadPosts(false);
window.showMy = ()=>loadPosts(true);

window.showForm = ()=>{
if(!currentUser) return alert("Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹");
formBox.classList.remove("hide");
posts.innerHTML="";
};

/* Save Post */
window.savePost = async ()=>{
if(!currentUser) return;
await addDoc(collection(db,"posts"),{
title:title.value,
price:price.value,
category:category.value,
uid:currentUser.uid,
created:Date.now()
});
title.value=price.value="";
showHome();
};

/* Load Posts */
async function loadPosts(onlyMine){
formBox.classList.add("hide");
posts.innerHTML="";
if(!currentUser) return;

let q = onlyMine
? query(collection(db,"posts"), where("uid","==",currentUser.uid))
: query(collection(db,"posts"));

const snap = await getDocs(q);
snap.forEach(doc=>{
const p = doc.data();
posts.innerHTML += `
<div class="card">
<b>${p.title}</b><br>
${p.category}<br>
<span class="price">${p.price} ğŸ’°</span>
</div>`;
});
}
</script>

</body>
</html>
